<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>TIDS - Controle Total</title>
<style>
body{font-family:'Roboto',sans-serif;background:#222;color:#fff;padding:20px;}
h1{color:#ffd700;margin-bottom:20px;text-align:center;}
table{width:80%;margin:0 auto;border-collapse:collapse;}
th, td{padding:12px 15px;border-bottom:1px solid #555;text-align:center;}
th{background:#2575fc;}
tr:hover{background:rgba(37,117,252,0.2);}
button{padding:6px 12px;border:none;border-radius:8px;background:#ff4d4d;color:white;cursor:pointer;transition:0.3s;}
button:hover{background:#ff1a1a; transform:scale(1.05);}
.alert{
    position:fixed;
    top:20px;
    left:50%;
    transform:translateX(-50%);
    background:#28a745;
    color:#fff;
    padding:10px 20px;
    border-radius:10px;
    display:none;
    animation:fadein 0.5s, fadeout 0.5s 2s;
}
@keyframes fadein{from{opacity:0;}to{opacity:1;}}
@keyframes fadeout{from{opacity:1;}to{opacity:0;}}
</style>
</head>
<body>
<h1>Painel de Controle Total</h1>
<div class="alert" id="alert">Usuário excluído!</div>

<h2 style="text-align:center; color:#ffd700;">Usuários</h2>
<table>
    <tr>
        <th>Usuário</th>
        <th>Data de Criação</th>
        <th>Ações</th>
    </tr>
    {% for user in users %}
    <tr id="user-{{ user.username }}">
        <td>{{ user.username }}</td>
        <td>{{ user.date }}</td>
        <td>
            {% if user.username not in SPECIAL_USERS %}
            <form method="POST" action="/delete_user" style="display:inline;" onsubmit="return confirmDelete(this)">
                <input type="hidden" name="username" value="{{ user.username }}">
                <button type="submit">Excluir</button>
            </form>
            {% else %}
            <span style="color:#aaa;">Admin protegido</span>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>

<script>
function showAlert(){
    const alertBox = document.getElementById('alert');
    alertBox.style.display = 'block';
    setTimeout(()=>{ alertBox.style.display = 'none'; }, 2500);
}

function confirmDelete(form){
    const reaction = prompt("Você tem certeza? Coloque a reação para o usuário:");
    if(!reaction) return false;
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = "reaction";
    input.value = reaction;
    form.appendChild(input);
    return true;
}

document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function(e){
        e.preventDefault();
        const row = form.closest('tr');
        fetch(form.action, {method:'POST', body:new FormData(form)})
        .then(res=>res.text())
        .then(()=>{row.style.transition='opacity 0.5s';row.style.opacity=0;showAlert(); setTimeout(()=>row.remove(),500);});
    });
});
</script>
</body>
</html>
